var elems = document.querySelectorAll("div, section, article, p, span, a, li, h1, h2, h3, em, b, caption");

//case insensitive searchWords
var searchWords = [
    'Lord Voldemort',
    'Voldemort'
];

//replaceWords case won't match original, so we capitalize as best as possible.
var replaceWords = [
    'You-Know-Who', 
    'He-Who-Must-Not-Be-Named', 
    'the Dark Lord'
];

//function that does the work.
function voldemortReplacer(){
    var value = newValue = "";
    var replaceRegExp;
    
    var pluralSearchWords = searchWords.slice(0); //clone array
    for(var i in searchWords){
        searchWords[i] = '\\b'+searchWords[i]+'\\b';
    }
    for(var i in pluralSearchWords){
        pluralSearchWords[i] = '\\b'+pluralSearchWords[i]+"('s)?\\b";
    }
    
    for(var i=0; i < elems.length; i++){
        if(!elems[i].firstChild || !elems[i].firstChild.nodeValue){
            continue;
        }
        value = elems[i].firstChild.nodeValue;
        if (new RegExp(searchWords.join("|"), 'ig').test(value) || 
            new RegExp(pluralSearchWords.join("|"), 'i').test(value)) {
            //found a match, now figure out which word it was.
            for(var j in searchWords){
                value = elems[i].firstChild.nodeValue;
                if(new RegExp(searchWords[j], 'ig').test(value)){
                    newValue = replaceWords[j];
                    replaceRegExp = new RegExp(searchWords[j], 'ig');
                }else if(new RegExp(pluralSearchWords[j], 'ig').test(value)){
                    newValue = replaceWords[j]+"'s";
                    replaceRegExp = new RegExp(pluralSearchWords[j], 'ig');
                }else{
                    continue;
                }
                elems[i].firstChild.nodeValue = value.replace(replaceRegExp, newValue);
            }
        }
    }
}

//call the function
voldemortReplacer();

window.onload= function () {
    if(window.addEventListener) {
        document.body.addEventListener('change', voldemortReplacer, false);
    } else if (window.attachEvent){
        document.body.attachEvent("onchange", voldemortReplacer);
    }
}
